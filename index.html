<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IndiWander | Explore</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Poppins,sans-serif;
  background:#000;
  overflow:hidden;
  color:white;
}

/* UI Overlay */
.ui{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  z-index:10;
}

.ui h1{font-size:2.5rem}
.ui p{color:#94a3b8;margin-bottom:1.5rem}

.search{
  opacity:0;
  transform:translateY(20px);
  transition:.5s;
  pointer-events:none;
}

.search.active{
  opacity:1;
  transform:none;
  pointer-events:auto;
}

input{
  padding:.8rem 1.4rem;
  border-radius:30px;
  border:none;
  font-size:1rem;
  width:260px;
}

button{
  margin-top:1rem;
  padding:.6rem 1.8rem;
  border-radius:30px;
  border:none;
  background:#38bdf8;
  color:#000;
  font-weight:600;
  cursor:pointer;
}

/* Map */
#map{
  position:fixed;
  inset:0;
  display:none;
  z-index:1;
}
</style>
</head>

<body>

<div id="map"></div>

<div class="ui">
  <h1>Where do you want to go?</h1>
  <p>Click the globe to begin</p>

  <div class="search" id="searchBox">
    <input id="destination" placeholder="Search destinationâ€¦">
    <br>
    <button onclick="search()">Show itinerary</button>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const mapLocation = params.get("map");

/* ================= MAP MODE ================= */
if(mapLocation){
  document.getElementById("map").style.display="block";

  const locations={
    goa:[15.2993,74.1240],
    rajasthan:[27.0238,74.2179],
    kerala:[10.8505,76.2711],
    himachal:[31.1048,77.1734],
    varanasi:[25.3176,82.9739]
  };

  const coords = locations[mapLocation];
  if(coords){
    const map = L.map("map").setView(coords,6);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
    L.marker(coords).addTo(map).bindPopup(mapLocation.toUpperCase()).openPopup();
  }

}
/* ================= GLOBE MODE ================= */
else{

  /* THREE JS FULLSCREEN CANVAS */
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const texture = new THREE.TextureLoader().load(
    "https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg"
  );

  const globe = new THREE.Mesh(
    new THREE.SphereGeometry(5,64,64),
    new THREE.MeshStandardMaterial({map:texture})
  );
  scene.add(globe);

  scene.add(new THREE.AmbientLight(0x404040,1.5));
  const light = new THREE.PointLight(0xffffff,2);
  light.position.set(10,10,10);
  scene.add(light);

  camera.position.z = 14;

  let spinning=false;

  function animate(){
    requestAnimationFrame(animate);
    if(spinning) globe.rotation.y+=0.003;
    renderer.render(scene,camera);
  }
  animate();

  window.addEventListener("resize",()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
  });

  document.body.addEventListener("click",()=>{
    spinning=true;
    document.getElementById("searchBox").classList.add("active");
  });

  window.search=function(){
    const val=document.getElementById("destination").value.trim().toLowerCase();
    if(!val) return;
    window.location.href=`itineraries/${val}.html`;
  }
}
</script>

</body>
</html>
