<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IndiWander | Explore the World</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js">/* ===== BACK TO GLOBE ===== */
document.getElementById('backBtn').addEventListener('click', () => {
  document.getElementById('mapWrapper').style.display = 'none';
  document.getElementById('backBtn').style.display = 'none';
  document.getElementById('globeContainer').style.display = 'block';
  renderer.setSize(360, 360);
  camera.aspect = 1;
  camera.updateProjectionMatrix();

  camera.position.z = 16;
  spinning = false;
  zooming = false;
});

</script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at center, #020617 0%, #000 70%);
      color: white;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .wrapper { text-align: center; }

    h1 { font-size: 2.4rem; margin-bottom: 0.5rem; }
    p { color: #94a3b8; margin-bottom: 2rem; }

    /* ===== TRUE FLOATING GLOBE ===== */
    #globeContainer {
      width: 360px;
      height: 360px;
      margin: 0 auto;
      border-radius: 50%;
      overflow: visible;
      position: relative;
      pointer-events: auto;
      display: block;
    }

    #globeContainer::before {
      content: '';
      position: absolute;
      inset: -25px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(56,189,248,0.35), transparent 70%);
      filter: blur(25px);
      z-index: 0;
    }

    #globeCanvas canvas {
      display: block;
      border-radius: 50%;
      background: transparent;
    }

    /* ===== MAP PLANET ===== */
    #mapWrapper {
      width: 360px;
      height: 360px;
      margin: 0 auto;
      border-radius: 50%;
      display: none;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 80px rgba(56,189,248,0.45);
    }

    #map { width: 100%; height: 100%; }

    .leaflet-container {
      background: #000;
    }

    .leaflet-control-container { display: none; }

    .search-box {
      margin-top: 2rem;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
      pointer-events: none;
    }

    .search-box.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    input {
      width: 280px;
      padding: 0.8rem 1.2rem;
      border-radius: 30px;
      border: none;
      outline: none;
      font-size: 1rem;
    }

    .suggestions {
      margin-top: 0.6rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
    }

    .suggestions span {
      background: #1e293b;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    button {
      margin-top: 1.2rem;
      background: #38bdf8;
      color: #020617;
      border: none;
      padding: 0.6rem 1.8rem;
      border-radius: 30px;
      font-size: 1rem;
      cursor: pointer;
    }

    button:hover { background: #0ea5e9; }

    audio { display: none; }
  </style>
</head>
<body>

<div class="wrapper">
  <h1>Where do you want to go?</h1>
  <p>Click the globe and start your journey</p>

  <div id="globeContainer">
    <div id="globeCanvas"></div>
  </div>

  <button id="backBtn" style="display:none;margin-bottom:1rem;background:#1e293b;color:#fff;border:none;padding:0.5rem 1.4rem;border-radius:999px;cursor:pointer;">‚Üê Back to Globe</button>

  <div id="mapWrapper">
    <div id="map"></div>
  </div>

  <div class="search-box" id="searchBox">
    <input id="destination" placeholder="Search destination..." />

    <div class="suggestions">
      <span onclick="pick('goa')">Goa</span>
      <span onclick="pick('rajasthan')">Rajasthan</span>
      <span onclick="pick('bali')">Bali</span>
      <span onclick="pick('paris')">Paris</span>
      <span onclick="pick('tokyo')">Tokyo</span>
    </div>

    <button onclick="search()">Show Itinerary</button>
  </div>
</div>

<audio id="spinSound" src="https://assets.mixkit.co/sfx/preview/mixkit-fast-small-sweep-transition-166.wav"></audio>

<script>
/* ===== THREE.JS TRUE SPHERE ===== */
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, powerPreference: 'high-performance' });
renderer.setSize(360, 360);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.setClearColor(0x000000, 0);

document.getElementById('globeCanvas').appendChild(renderer.domElement);

const geometry = new THREE.SphereGeometry(5, 96, 96);
const texture = new THREE.TextureLoader().load('https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg');

const material = new THREE.MeshPhysicalMaterial({
  map: texture,
  roughness: 0.25,
  metalness: 0.0,
  clearcoat: 0.4,
  clearcoatRoughness: 0.2
});

const globe = new THREE.Mesh(geometry, material);
scene.add(globe);

scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const sun = new THREE.DirectionalLight(0xffffff, 1.4);
sun.position.set(10, 10, 10);
scene.add(sun);

/* ===== DESTINATION LIGHTS ===== */
const destinations = [
  { name: 'India', lat: 20.6, lon: 78.9 },
  { name: 'France', lat: 46.2, lon: 2.2 },
  { name: 'Japan', lat: 36.2, lon: 138.3 },
  { name: 'Indonesia', lat: -2.5, lon: 118.0 },
  { name: 'Italy', lat: 41.9, lon: 12.6 },
  { name: 'USA', lat: 39.8, lon: -98.6 }
];

const lightGroup = new THREE.Group();
const lightMaterial = new THREE.MeshBasicMaterial({ color: 0xffd700 });

function latLngToVector3(lat, lon, radius) {
  const phi = (90 - lat) * (Math.PI / 180);
  const theta = (lon + 180) * (Math.PI / 180);
  return new THREE.Vector3(
    -radius * Math.sin(phi) * Math.cos(theta),
     radius * Math.cos(phi),
     radius * Math.sin(phi) * Math.sin(theta)
  );
}

destinations.forEach(dest => {
  const markerGeo = new THREE.SphereGeometry(0.12, 16, 16);
  const marker = new THREE.Mesh(markerGeo, lightMaterial.clone());
  marker.position.copy(latLngToVector3(dest.lat, dest.lon, 5.05));
  marker.userData = dest;
  lightGroup.add(marker);
});

scene.add(lightGroup);

camera.position.z = 16;

let spinning = false;
let zooming = false;
let hoveredMarker = null;

const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
let zooming = false;

function animate() {
  requestAnimationFrame(animate);
  globe.rotation.y += spinning ? 0.004 : 0.001;

  if (zooming && camera.position.z > 11) {
    camera.position.z -= 0.035;
  }

  renderer.render(scene, camera);
}
animate();

/* ===== HOVER & CLICK DETECTION ===== */
renderer.domElement.addEventListener('mousemove', (e) => {
  const rect = renderer.domElement.getBoundingClientRect();
  mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObjects(lightGroup.children);

  if (intersects.length > 0) {
    const obj = intersects[0].object;
    if (hoveredMarker !== obj) {
      if (hoveredMarker) hoveredMarker.scale.set(1, 1, 1);
      hoveredMarker = obj;
      hoveredMarker.scale.set(1.8, 1.8, 1.8);
      document.body.style.cursor = 'pointer';
    }
  } else {
    if (hoveredMarker) hoveredMarker.scale.set(1, 1, 1);
    hoveredMarker = null;
    document.body.style.cursor = 'default';
  }
});

renderer.domElement.addEventListener('click', () => {
  if (!hoveredMarker) return;
  const country = hoveredMarker.userData.name;
  document.getElementById('destination').value = country.toLowerCase();
  document.getElementById('searchBox').classList.add('active');
});

/* ===== INTERACTION ===== */
document.getElementById('globeContainer').addEventListener('click', () => {
  spinning = true;
  zooming = true;
  document.getElementById('searchBox').classList.add('active');
  document.getElementById('spinSound').play();
});

function pick(place) {
  document.getElementById('destination').value = place;
}

function search() {
  spinning = false;
  zooming = false;
  const val = document.getElementById('destination').value.trim().toLowerCase();
  if (!val) return alert('Enter destination');

  document.getElementById('globeContainer').style.display = 'none';
  document.getElementById('mapWrapper').style.display = 'block';

  const locations = {
    goa: [15.2993, 74.1240],
    rajasthan: [27.0238, 74.2179],
    bali: [-8.3405, 115.0920],
    paris: [48.8566, 2.3522],
    tokyo: [35.6762, 139.6503]
  };

  const coords = locations[val];
  if (!coords) return alert('Location not mapped yet');

  const map = L.map('map', {
    zoomControl: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    dragging: true,
    attributionControl: false
  }).setView(coords, 5);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  L.marker(coords).addTo(map).bindPopup(val.toUpperCase()).openPopup();

  setTimeout(() => map.invalidateSize(), 300);
  document.getElementById('backBtn').style.display = 'inline-block';
}
</script>

</body>
</html>
